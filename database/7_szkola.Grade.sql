create temporary table szkola.GradeTemp (
	GradeValueID INT,
	Owner_UserID INT
);

insert into szkola.GradeTemp (GradeValueID, Owner_UserID) values (14, 582),
 (5, 96),
 (11, 672),
 (12, 273),
 (13, 295),
 (7, 259),
 (4, 129),
 (10, 476),
 (5, 668),
 (14, 284),
 (7, 667),
 (4, 76),
 (6, 456),
 (5, 64),
 (5, 360),
 (1, 471),
 (6, 137),
 (5, 473),
 (8, 256),
 (7, 154),
 (11, 649),
 (9, 90),
 (2, 332),
 (5, 460),
 (7, 667),
 (3, 672),
 (12, 499),
 (9, 115),
 (7, 476),
 (6, 237),
 (8, 554),
 (9, 234),
 (10, 517),
 (11, 544),
 (9, 603),
 (5, 208),
 (9, 417),
 (1, 400),
 (6, 212),
 (9, 233),
 (5, 586),
 (2, 93),
 (7, 41),
 (8, 629),
 (3, 59),
 (9, 298),
 (13, 41),
 (4, 152),
 (2, 597),
 (2, 73),
 (4, 152),
 (9, 283),
 (8, 252),
 (10, 437),
 (1, 399),
 (9, 644),
 (14, 225),
 (6, 155),
 (7, 105),
 (5, 492),
 (8, 429),
 (9, 581),
 (11, 505),
 (9, 74),
 (1, 108),
 (12, 313),
 (9, 399),
 (3, 23),
 (6, 545),
 (3, 680),
 (3, 546),
 (13, 146),
 (7, 540),
 (6, 373),
 (8, 419),
 (9, 197),
 (6, 561),
 (5, 689),
 (7, 489),
 (7, 308),
 (7, 293),
 (6, 167),
 (2, 180),
 (12, 45),
 (10, 7),
 (13, 674),
 (8, 378),
 (7, 344),
 (6, 152),
 (11, 661),
 (11, 642),
 (8, 205),
 (6, 186),
 (10, 215),
 (6, 227),
 (9, 379),
 (12, 169),
 (11, 479),
 (2, 418),
 (8, 663),
 (6, 326),
 (10, 192),
 (3, 220),
 (5, 65),
 (10, 434),
 (7, 680),
 (15, 397),
 (6, 47),
 (7, 140),
 (5, 97),
 (7, 47),
 (3, 346),
 (5, 618),
 (7, 227),
 (10, 161),
 (13, 591),
 (3, 281),
 (8, 261),
 (14, 225),
 (12, 42),
 (7, 544),
 (9, 686),
 (5, 166),
 (8, 278),
 (7, 630),
 (8, 45),
 (18, 73),
 (8, 666),
 (1, 326),
 (6, 76),
 (7, 54),
 (12, 500),
 (6, 96),
 (14, 303),
 (8, 87),
 (11, 296),
 (12, 184),
 (9, 559),
 (12, 359),
 (10, 437),
 (7, 211),
 (14, 149),
 (6, 486),
 (12, 227),
 (9, 44),
 (9, 152),
 (5, 639),
 (8, 538),
 (5, 561),
 (6, 436),
 (11, 188),
 (9, 318),
 (6, 141),
 (12, 373),
 (5, 629),
 (9, 56),
 (7, 548),
 (9, 689),
 (9, 123),
 (8, 499),
 (11, 666),
 (10, 48),
 (10, 26),
 (7, 320),
 (8, 331),
 (11, 127),
 (14, 635),
 (7, 652),
 (5, 433),
 (8, 563),
 (7, 541),
 (1, 205),
 (7, 51),
 (11, 295),
 (15, 109),
 (8, 377),
 (9, 367),
 (8, 78),
 (7, 300),
 (1, 377),
 (8, 478),
 (8, 265),
 (3, 191),
 (10, 145),
 (8, 201),
 (8, 634),
 (9, 272),
 (8, 609),
 (12, 262),
 (8, 341),
 (11, 572),
 (7, 368),
 (11, 482),
 (7, 64),
 (10, 547),
 (1, 438),
 (5, 385),
 (11, 360),
 (9, 465),
 (6, 601),
 (5, 525),
 (6, 435),
 (8, 162),
 (6, 361),
 (10, 334),
 (7, 1),
 (7, 386),
 (12, 663),
 (9, 406),
 (4, 444),
 (9, 297),
 (12, 214),
 (4, 44),
 (8, 301),
 (4, 61),
 (5, 41),
 (8, 476),
 (4, 243),
 (9, 674),
 (10, 668),
 (8, 332),
 (8, 62),
 (5, 214),
 (9, 496),
 (8, 227),
 (6, 431),
 (5, 196),
 (7, 624),
 (11, 597),
 (3, 457),
 (9, 223),
 (6, 368),
 (10, 519),
 (12, 198),
 (1, 24),
 (18, 571),
 (15, 604),
 (10, 325),
 (6, 509),
 (8, 562),
 (10, 249),
 (15, 15),
 (6, 484),
 (7, 458),
 (4, 173),
 (8, 233),
 (9, 395),
 (11, 549),
 (7, 141),
 (4, 493),
 (12, 429),
 (8, 44),
 (9, 218),
 (10, 685),
 (11, 288),
 (4, 150),
 (3, 251),
 (11, 619),
 (7, 407),
 (9, 536),
 (9, 571),
 (14, 629),
 (4, 11),
 (10, 527),
 (8, 477),
 (7, 337),
 (9, 517),
 (9, 502),
 (8, 48),
 (9, 160),
 (16, 565),
 (7, 276),
 (11, 643),
 (1, 578),
 (8, 262),
 (2, 173),
 (5, 574),
 (8, 163),
 (8, 258),
 (6, 377),
 (13, 267),
 (6, 640),
 (12, 413),
 (7, 141),
 (5, 141),
 (14, 40),
 (6, 213),
 (7, 371),
 (13, 86),
 (8, 254),
 (9, 106),
 (2, 631),
 (1, 147),
 (11, 66),
 (3, 83),
 (9, 388),
 (11, 68),
 (6, 331),
 (6, 202),
 (8, 216),
 (10, 118),
 (11, 316),
 (8, 647),
 (2, 370),
 (8, 362),
 (1, 204),
 (2, 468),
 (7, 559),
 (14, 32),
 (8, 290),
 (8, 396),
 (6, 221),
 (8, 202),
 (5, 190),
 (5, 410),
 (10, 606),
 (12, 14),
 (2, 636),
 (10, 48),
 (5, 107),
 (9, 274),
 (13, 143),
 (14, 591),
 (8, 56),
 (10, 303),
 (6, 475),
 (8, 231),
 (11, 422),
 (8, 1),
 (12, 98),
 (9, 130),
 (4, 85),
 (15, 542),
 (6, 396),
 (10, 424),
 (10, 571),
 (10, 280),
 (11, 308),
 (5, 684),
 (7, 360),
 (14, 468),
 (12, 240),
 (8, 488),
 (6, 343),
 (9, 678),
 (11, 591),
 (8, 117),
 (7, 35),
 (11, 90),
 (6, 646),
 (13, 527),
 (9, 229),
 (6, 284),
 (2, 361),
 (3, 336),
 (11, 184),
 (9, 294),
 (5, 30),
 (9, 50),
 (4, 174),
 (14, 73),
 (4, 255),
 (10, 539),
 (4, 108),
 (10, 122),
 (9, 536),
 (5, 512),
 (11, 607),
 (14, 185),
 (9, 287),
 (6, 425),
 (10, 303),
 (4, 396),
 (7, 307),
 (5, 469),
 (5, 16),
 (9, 239),
 (8, 424),
 (7, 430),
 (9, 623),
 (7, 632),
 (11, 65),
 (12, 5),
 (9, 212),
 (13, 338),
 (6, 50),
 (7, 694),
 (6, 597),
 (14, 57),
 (15, 646),
 (7, 671),
 (11, 155),
 (4, 383),
 (1, 565),
 (7, 40),
 (5, 321),
 (5, 38),
 (10, 60),
 (8, 284),
 (12, 378),
 (2, 161),
 (11, 8),
 (6, 270),
 (8, 392),
 (4, 191),
 (10, 600),
 (6, 582),
 (14, 193),
 (4, 599),
 (6, 306),
 (9, 230),
 (4, 62),
 (11, 417),
 (10, 440),
 (13, 582),
 (10, 241),
 (6, 481),
 (14, 102),
 (9, 554),
 (9, 575),
 (12, 28),
 (10, 296),
 (9, 672),
 (4, 595),
 (6, 408),
 (8, 28),
 (6, 4),
 (7, 451),
 (6, 207),
 (9, 167),
 (7, 117),
 (6, 492),
 (14, 126),
 (1, 8),
 (8, 404),
 (4, 426),
 (8, 75),
 (9, 210),
 (4, 446),
 (12, 678),
 (1, 530),
 (7, 404),
 (7, 454),
 (15, 576),
 (9, 683),
 (10, 231),
 (10, 290),
 (12, 380),
 (9, 422),
 (8, 559),
 (7, 566),
 (2, 117),
 (2, 454),
 (6, 368),
 (8, 371),
 (3, 502),
 (10, 468),
 (5, 54),
 (15, 564),
 (11, 193),
 (4, 492),
 (6, 521),
 (9, 250),
 (8, 97),
 (5, 122),
 (10, 498),
 (10, 494),
 (12, 639),
 (7, 555),
 (4, 134),
 (10, 442),
 (8, 422),
 (9, 208),
 (7, 22),
 (10, 590),
 (5, 262),
 (12, 169),
 (18, 311),
 (8, 566),
 (7, 131),
 (10, 204),
 (1, 482),
 (6, 419),
 (9, 644),
 (9, 103),
 (6, 3),
 (12, 164),
 (8, 678),
 (5, 199),
 (12, 230),
 (8, 192),
 (9, 70),
 (11, 377),
 (17, 343),
 (6, 531),
 (3, 174),
 (15, 187),
 (7, 493),
 (10, 148),
 (9, 173);

-- this query takes generated random values from temporary table, and adds random subject and it's teacher to each grade,
-- based on grade owner's class ID, and inserts it into final destination table Grade
INSERT INTO
    Grade
        (Owner_UserID, SubjectID, Issuer_UserID, GradeValueID)
    SELECT
        UserID AS Owner_UserID,
        SUBSTRING_INDEX(RandomSubjectTeacher, ';', 1) AS SubjectID,
        SUBSTRING_INDEX(SUBSTRING_INDEX(RandomSubjectTeacher, ';', 2), ';', -1)AS Issuer_UserID,
        GradeValueID
    FROM
    (
        SELECT User.UserID,
            SUBSTRING_INDEX(
                    GROUP_CONCAT(
                            CONCAT(ClassSubjectTeacher.SubjectID, ';', ClassSubjectTeacher.Teacher_UserID) order by RAND(),
                            ',')
                , ',', 1) AS RandomSubjectTeacher
        FROM User
            INNER JOIN Student ON Student.UserID = User.UserID
            INNER JOIN ClassSubjectTeacher ON ClassSubjectTeacher.ClassID = Student.ClassID
        GROUP BY User.UserID
    ) innerQ
    INNER JOIN GradeTemp ON UserID = GradeTemp.Owner_UserID;

DROP TEMPORARY TABLE GradeTemp;

